if (CORE == undefined) {	throw 'CORE global.js needs to be imported first!';}/** * Shows validation errors * * Use the form parameter if you have more than one model with more than * one form per page, and just wish to show errors on that form. * * * @param string form The id of the form to search. If none, it searches all * @return boolean Whether or not there were any errors */CORE.showValidationErrors = function(form) {	var passed = true;		if (form == undefined) {		form = '';	} else {		form = '#'+form;	}		// get list of errors	$('#content '+form+' div.error-message').each(function() {		passed = false;		CORE.showValidationError($(this));	});	return passed;}/** * Handles any setup before submitting a form * * @param object event The event for the click * @param object XMLHttpRequest The XMLHttpRequest * @return boolean If the request will continue */CORE.beforeForm = function(event, XMLHttpRequest) {		// stop the request if this button has been clicked	if ($(event.originalTarget).data('disabled')) {		XMLHttpRequest.abort();		return false;	}		XMLHttpRequest.async = false;		$('div.error-message').each(function(i) { $(this).fadeOut() });		$('.tabs a').each(function(i) { $(this).removeClass('error'); });		$(event.originalTarget).addClass('loading');	$(event.originalTarget).data('disabled', true);	return true;}/** * Handles actions after a form has been submitted *  * @param object event The event for the click * @param object XMLHttpRequest The XMLHttpRequest * @param object textStatus The textStatus */CORE.completeForm = function(event, XMLHttpRequest, textStatus) {	// scroll to top	$.scrollTo('#container', 500);		// allow submit to be clicked again	$(event.originalTarget).data('disabled', false);	$(event.originalTarget).removeClass('loading');}/** * Handles actions after successful form submission * * #### Options: *		- function success Callback for a successful (validated) form (Default none) *		- function failure Callback for an unsuccessful form (Default none) *		- boolean autoUpdate Whether to update the content (Default true) *		- boolean closeModals Whether to close the modal (Default false) * * @param object event The event for the click * @param object data The returned data * @param object textStatus The ajax options * @param object options Success options */CORE.successForm = function(event, data, textStatus, options) {	var _defaultOptions = {		success: false,		failure: false,		autoUpdate: true,		closeModals: false	};		options = $.extend(_defaultOptions, options);		// check to see if it validates	$('#content').append('<div id="temp"></div>');	$('#temp').html(data).css('display', 'none');	validates = CORE.showValidationErrors('temp');	$('#temp').remove();		// update the content	switch (options.autoUpdate) {		case 'failure':			if (!validates) {				$('#content').html(data);				CORE.showValidationErrors($(event.currentTarget).closest('form').attr('id'));			}		break;		case "success":		default:			if (validates) {				$('#content').html(data);				CORE.showValidationErrors($(event.currentTarget).closest('form').attr('id'));			}		break;	} 		if (validates) {		if (options.success != false) {			options.success();		} 		if (options.closeModals) {			CORE.closeModals();		}	} else {		if (options.failure != false) {			options.failure();		}	}}/** * Handles actions after failed form submission *  * @param object event The event for the click * @param object XMLHttpRequest The XMLHttpRequest * @param object textStatus The error settings * @param object errorThrown The error */CORE.errorForm = function(event, XMLHttpRequest, textStatus, errorThrown) {	redirect('/pages/form_error');}/** * Shows a validation error on a field (built on * Cake's FormHelper output) *  * @param object field The error field */CORE.showValidationError = function(field) {	$('.tabs').each(function() {		// get fieldset that this field belongs to		var fieldset = $(field).parent('div').parent('fieldset').attr('id');				// add error class to fieldset		if (fieldset != '') {			$('.tabs a[href$='+fieldset+']').each(function() {				$(this).addClass('error');			});		}	});	}/** * Only allows one checkbox per value to be checked. * * This will iterate through all radio and checkboxes and automatically * set `change` events to detect if the checkbox/radio is checked  * and disable similar checkboxes (useful when selecting multiple users * when they may appear more than once on screen) *  * @param string fieldset ID of the fieldset to  */CORE.noDuplicateCheckboxes = function(fieldset) {	$('#'+fieldset+' input[type=checkbox], #'+fieldset+' input[type=radio]').each(function() {		$(this).bind('change', function() {			if (this.checked) {				$('#'+fieldset+' input[value='+this.value+'][type=checkbox], #'+fieldset+' input[value='+this.value+'][type=radio]').attr('disabled', 'disabled');				$('#'+fieldset+' input[value='+this.value+'][type=checkbox], #'+fieldset+' input[value='+this.value+'][type=radio]').removeAttr('checked');				$(this).removeAttr('disabled');				$(this).attr('checked', 'checked');			} else {				$('#'+fieldset+' input[value='+this.value+'][type=checkbox], #'+fieldset+' input[value='+this.value+'][type=radio]').removeAttr('disabled');			}					});	});}